<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel - Hydrian</title>
    <link rel="icon" href="../static/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="../static/css/inicio.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.0/mapbox-gl.css' rel='stylesheet'/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="../static/img/hydrian_branco.png" alt="Hydrian" class="logo">
        </div>
        <div class="user-info">
            <span class="user-name" id="userName">Usuário</span>
            <button class="logout-btn" id="logoutBtn">Sair</button>
        </div>
    </header>

    <main class="main-content">
        <div class="dashboard-grid">
            <div class="map-panel">
                <section class="map-container">
                    <div class="map-header">
                        <h3 class="map-title">Mapa de Dispositivos</h3>
                        <p class="map-subtitle">Clique nos marcadores para ver detalhes dos sensores</p>

                        <div class="map-stats" id="mapStats">
                            <div class="stat-card">
                                <span class="stat-title">Dispositivos Ativos</span>
                                <span class="stat-value" id="activeDevices">0 (0%)</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-title">Última Atualização</span>
                                <span class="stat-value" id="lastUpdate">--</span>
                            </div>
                        </div>
                    </div>

                    <div id="map"></div>

                    <div class="side-modal" id="sensorSideModal">
                        <div class="side-modal-header">
                            <h2>Dados do Sensor</h2>
                            <div class="side-modal-buttons">
                                <button class="expand-side-modal" onclick="toggleExpandSideModal()">⛶</button>
                                <button class="close-side-modal" onclick="closeSideModal()">×</button>
                            </div>  
                        </div>

<div class="side-modal-body" id="sideModalContent">
    <div id="sensorFilter" style="display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap;">
        <label style="display:flex; flex-direction:column; font-size:12px;">
            De:
            <input type="datetime-local" id="filterStart" style="padding:4px; border-radius:4px; border:1px solid #ccc;">
        </label>
        <label style="display:flex; flex-direction:column; font-size:12px;">
            Até:
            <input type="datetime-local" id="filterEnd" style="padding:4px; border-radius:4px; border:1px solid #ccc;">
        </label>
        <button id="applyFilter" style="background:#1e88e5; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:13px; font-weight:bold;">Filtrar</button>
        <button id="clearFilter" style="background:#757575; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:13px; font-weight:bold;">Limpar</button>
    </div>

    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 12px;">
        <div style="grid-column: span 2;">
            <h4 style="margin: 4px 0; font-size: 14px;">Aceleração</h4>
            <canvas id="accelChart" width="400" height="150"></canvas>
        </div>
        
<!--             
        <div>
            <h4 style="margin: 4px 0; font-size: 14px;">RMS</h4>
            <canvas id="rmsChart" width="400" height="150"></canvas>
        </div>
        
        <div>
            <h4 style="margin: 4px 0; font-size: 14px;">Peak</h4>
            <canvas id="peakChart" width="400" height="150"></canvas>
        </div>
        
        <div>
            <h4 style="margin: 4px 0; font-size: 14px;">Crest Factor</h4>
            <canvas id="crestChart" width="400" height="150"></canvas>
        </div>
-->       
        <div>
            <h4 style="margin: 4px 0; font-size: 14px;">Temperatura</h4>
            <canvas id="tempChart" width="400" height="150"></canvas>
        </div>

        <div>
            <h4 style="margin: 4px 0; font-size: 14px;">FFT (Eixo Z)</h4>
            <canvas id="fftChart" width="400" height="150"></canvas>
        </div>

    </div>
</div>

                </section>
            </div>
        </div>
    </main>

    <div class="map-actions">
        <button class="open-modal-btn" onclick="openSensorModal()">
            Adicionar Sensor
        </button>

        <button class="open-modal-btn" onclick="generateReport()">
            Relatório
        </button>
    </div>

    <div class="modal-overlay" id="sensorModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Cadastrar Novo Sensor</h2>
                <button class="close-modal" onclick="closeSensorModal()">×</button>
            </div>

            <form id="sensorForm" class="modal-body" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="deviceId">ID do Dispositivo</label>
                    <input type="text" id="deviceId" name="sensor_name" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="latitude">Latitude</label>
                        <input type="number" id="latitude" name="latitude" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="longitude">Longitude</label>
                        <input type="number" id="longitude" name="longitude" step="any" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="equipmentType">Selecionar Equipamento</label>
                    <select id="equipmentType" name="equip" required>
                        <option value="">Selecione o equipamento</option>
                        <option value="motor_eletrico">Motor Elétrico</option>
                        <option value="bomba_centrifuga">Bomba Centrífuga</option>
                        <option value="conjunto_motobomba">Conjunto Moto-Bomba</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="host">Host / IP</label>
                    <input type="text" id="host" name="host" required>
                </div>

                <div class="form-group">
                    <label for="image">Imagem do Sensor</label>
                    <input type="file" id="image" name="image" accept="image/*">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeSensorModal()">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar Sensor</button>
                </div>
            </form>
        </div>
    </div>

<script src='https://api.mapbox.com/mapbox-gl-js/v2.14.0/mapbox-gl.js'></script>
<script>
    const now = new Date();
    const yesterday = new Date(now.getTime() - 24*60*60*1000);
    document.getElementById('filterStart').value = yesterday.toISOString().slice(0,16);
    document.getElementById('filterEnd').value = now.toISOString().slice(0,16);
</script>

<script src="../static/js/geo.js"></script>
<script src="../static/js/sensor.js"></script>
<script src="../static/js/sensor-live.js"></script>
<script src="../static/js/inicio.js"></script>
</body>
</html>
